Requirements 
Minikube 

### Possible error has a result of not starting minikube
Error: failed to get the Kubernetes version: Get "https://192.168.49.2:8443/version?timeout=5s": dial tcp 192.168.49.2:8443: connect: no route to host
#### Resolve issue
Minikube start
-- Ensure to Grant permission to all users to use docker daemon
`sudo chmod 777 /var/run/docker.sock`

### Istio Installation
`curl -L https://istio.io/downloadIstio | sh -`

`cd istio-1.19.3`

Add the istioctl client to your path (Linux or macOS):

`export PATH=$PWD/bin:$PATH`

For this installation, we use the demo configuration profile. Itâ€™s selected to have a good set of defaults for testing, but there are other profiles for production or performance testing.

`istioctl install --set profile=demo -y`

verify test 
`istioctl verify-install`

Install some necesary addons/components needed for istio control-plane

`cd istio-1.19.3`
`kubectl apply -f samples/addons`

verify these components are installed 
- **prometheus**: Collects and stores the
generated metrics as
time-series data
- **kiali**: A web console for
the mesh;
- **grafana**: Visualizes metrics
generated by the
proxies and collected
by Prometheus
- Jaeger: Distributed tracing system
to visualize request flow
through the mesh 


### Deploying your first application in the service mesh

**switch from default namespace to istio-deployment namespace**
kubectl config set-context $(kubectl config current-context) --namespace=istio-deployment

**Clone the repo below***
`git clone https://github.com/Goddhi/App-Deployment-with-Istio.git`

**inject the Istio service proxy so that this service can participate in the service mesh**

`istioctl kube-inject -f App-Deployment-with-Istio/Deployment/catalog.yml `

The istioctl kube-inject command takes a Kubernetes resource file and enriches
it with the sidecar deployment of the Istio service proxy and a few additional compo-
nents

To enable automatic injection, we label the istioinaction namespace with

`kubectl label namespace istio-deployment istio-inject=enabled`

**create the catalog deployment:**

`kubectl apply -f App-Deployment-with-Istio/Deployment/catalog.yml`

**RUn kubectl get pods to  see pods**
observe under 'READY' it shows 2/2 it means to containers are running inside the pod the containers are:
the application container
the side-contianer (envoy service proxy)

Query the catalog service from within the cluster with the hostname catalog.istio-deployment. to verify everythin is up and running

` kubectl run -i -n default --rm --restart=Never dummy \
--image=curlimages/curl --command -- \
sh -c 'curl -s http://catalog.istio-deployment/items/1' `

Next we deploy the webapp service, which aggregates the data from the other services
and displays it visually in the browser. This service also exposes an API that ends up
calling the catalog service, which we just deployed and verified. This means webapp is
like a frontend of the other backend services:

`kubectl apply -f App-Deployment-with-Istio/Deployment/webapp.yml`

verify the number of pods
`kubectl get pods`

verify if the webapp service is working perfectly

```
kubectl run -i -n default --rm --restart=Never dummy \
--image=curlimages/curl --command -- \
sh -c 'curl -s http://webapp.istio-deployment/items/1' 

```
kubectl get pod webapp-854656db8f-68b2k --template='{{(index (index .spec.containers 0).ports 0).containerPort}}{{"\n"}}'


command completes correctly, you should see the same JSON response as when
we called the catalog service directly


Port-forward the webapp deployment to view the the UI

`kubectl port-forward deploy/webapp --address 0.0.0.0 8080:8080`

go to the browser and view the UI
`http://VM-public-ip:8080`

### Allowing External traffic into the cluster using istio ingress gateway to expose our webapp service###

`kubectl apply -f App-Deployment-with-Istio/Deployment/gateway.yml`

port forwwarding  the istio-ingressgateway deployment

`kubectl port-forward deploy/istio-ingressgateway -n istio-system --address 0.0.0.0 8080:8080`

Verify if your gateway has a route

`istioctl proxy-config routes \
deploy/istio-ingressgateway.istio-system`

### Istio observability features
### Grafana
port-forward grafana service

`kubectl port-forward svc/grafana --address 0.0.0.0 3000:3000 -n istio-system`

view the Grafana UI in the browser
`http://VM-public-ip:3000`

